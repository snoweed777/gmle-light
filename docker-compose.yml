version: "3.8"

services:
  gmle-light:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: gmle-light
    ports:
      - "8000:8000"  # REST API
      - "3001:3001"  # GUI
    volumes:
      # Config and data directories (host-mounted for persistence)
      - ./config:/app/config
      - ./data:/app/data
      # .env file for API keys
      - ./.env:/app/.env
      # Source code (for development - changes reflect immediately)
      - ./gmle:/app/gmle
      - ./frontend:/app/frontend
      # Protect node_modules from being overwritten by host mount
      - /app/frontend/node_modules
    environment:
      - PYTHONUNBUFFERED=1
      - GMLE_CONFIG_DIR=/app/config
      - GMLE_DATA_DIR=/app/data
      # LLM API keys (from .env)
      - COHERE_API_KEY=${COHERE_API_KEY:-}
      - GROQ_API_KEY=${GROQ_API_KEY:-}
      - GOOGLE_AI_API_KEY=${GOOGLE_AI_API_KEY:-}
      - HUGGINGFACE_API_KEY=${HUGGINGFACE_API_KEY:-}
      - READWISE_TOKEN=${READWISE_TOKEN:-}
    # extra_hosts allows container to access host's localhost
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped
    stdin_open: true
    tty: true

