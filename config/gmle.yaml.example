# GMLE Light グローバル設定ファイル
# このファイルは全Space共通のデフォルト設定を定義します
# Space固有設定（config/spaces/<space_id>.yaml）で上書き可能です

version: "1.0"

# LLMプロバイダー設定
llm:
  active_provider: "groq"  # 現在使用中のLLMプロバイダー (cohere/gemini/groq)
  
  providers:
    cohere:
      api_url: "https://api.cohere.ai/v1/chat"
      default_model: "command-a-03-2025"
      available_models:
        - "command-a-03-2025"
        - "command-r-plus"
      # api_keyは環境変数COHERE_API_KEYから読み込み
    
    gemini:
      api_url: "https://generativelanguage.googleapis.com/v1beta"
      default_model: "gemini-2.5-flash"
      available_models:
        - "gemini-2.5-flash"
        - "gemini-2.5-pro"
        - "gemini-2.0-flash"
        - "gemini-1.5-pro"
        - "gemini-1.5-flash"
      # api_keyは環境変数GOOGLE_AI_API_KEYから読み込み
    
    groq:
      api_url: "https://api.groq.com/openai/v1"
      default_model: "llama-3.1-8b-instant"
      available_models:
        - "llama-3.1-8b-instant"
        - "llama-3.3-70b-versatile"
        - "mixtral-8x7b-32768"
        - "gemma-7b-it"
        - "gemma2-9b-it"
      # api_keyは環境変数GROQ_API_KEYから読み込み

# API設定（非LLM）
api:
  readwise:
    api_url: "https://readwise.io/api/v2/highlights/"
    # tokenは環境変数READWISE_TOKENから読み込み
  
  anki:
    # Docker内からホストMacのAnkiConnectに接続
    connect_url: "http://host.docker.internal:8765"
    connect_version: 6
  
  # 内部API設定（将来のマイクロサービス化対応）
  generation:
    microservice:
      enabled: false
      url: "http://localhost:8001"
  
  ingest:
    microservice:
      enabled: false
      url: "http://localhost:8002"

# Anki設定
anki:
  note_type_name: "GMLE_MCQA"
  deck_bank_prefix: "GMLE::Bank::"
  card_template:
    front: null
    back: null
    css: ""

# HTTP設定
http:
  timeout: 30.0
  max_retries: 3
  retry_backoff_base: 2

# レート制限設定
rate_limit:
  enabled: true
  requests_per_minute: 1
  requests_per_hour: 15
  requests_per_day: 360
  cooldown_seconds: 60

# ログ設定
logging:
  format: "human"  # human/json
  level: "INFO"    # DEBUG/INFO/WARNING/ERROR
  file: null       # null=自動
  rotation_days: 30

# ロック設定
lock:
  stale_seconds: 3600

# Ingest設定
ingest:
  excerpt_min: 200
  excerpt_max: 800
  quarantine_min_length: 200

# デフォルトパラメータ
params:
  total: 30
  new_total: 10
  maintain_total: 20
  coverage: 3
  improve: 7
  reward_cap: 3
  domain_cap_steps: [6, 7, 8, 9999]
  excerpt_min: 200
  excerpt_max: 800
  rationale_quote_max: 100

# プロンプトテンプレート設定
prompts:
  stage1_extract:
    description: "Stage 1: 事実抽出プロンプト"
    template: |
      以下のテキストから重要な事実を抽出してください。
      各事実には、元のテキストからの引用（support_quote）を必ず含めてください。
      
      【テキスト】
      {excerpt}
      
      【出力形式】
      JSONフォーマットで返してください：
      {{
        "facts": [
          {{"id": "f1", "text": "事実の内容", "support_quote": "元のテキストからの引用"}}
        ]
      }}
  
  stage2_build_mcq:
    description: "Stage 2: MCQ生成プロンプト"
    template: |
      以下の事実から多肢選択問題（MCQ）を作成してください。
      
      【事実】
      {facts}
      
      【出力形式】
      JSONフォーマットで返してください：
      {{
        "question": "問題文",
        "choices": ["A: 選択肢1", "B: 選択肢2", "C: 選択肢3", "D: 選択肢4"],
        "answer": "A",
        "rationale": {{
          "text": "解説文",
          "quote": "元のテキストからの引用（100文字以内）"
        }}
      }}
